<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Lesson Slider</title>
  
  <!-- Import Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  
  <style>
    /* --- Base Reset --- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      min-height: 100vh; /* Changed */
      width: 100%;
      /* REMOVED overflow: hidden to allow scrolling */
      background-color: #f0f0f0; /* Added a light page background */
      /* Add smooth scroll-behavior for when user clicks a card */
      scroll-behavior: smooth;
    }
  
    /* --- General Section --- */
    
    /* --- NEW Sticky Container --- */
    /* This div acts as the "track" for the sticky element. */
    /* Its height determines how long you scroll to get through the animation. */
    /* 300vh = 100vh for the view + 200vh of scroll distance. */
    .sticky-scroll-container {
      position: relative;
      height: 400vh; /* MODIFIED: Was 300vh. Added 100vh for the "pause" at the end. */
    }

    .slider-section {
      /* --- MODIFIED for sticky --- */
      position: sticky; /* Stick to the top of .sticky-scroll-container */
      top: 0;
      /* --- End of MODIFIED --- */

      overflow: hidden;
      font-family: 'Roboto', serif;
      background: linear-gradient(135deg, black, #220033);
      height: 100vh; /* Ensure section takes full height */
      width: 100%; /* Ensure section takes full width */
    }

    /* --- ADDED Placeholder Styles --- */
    .placeholder-section {
      height: 50vh; /* 50% of the viewport height */
      padding: 40px;
      font-family: 'Roboto', sans-serif;
      background-color: #ffffff;
      border-bottom: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .placeholder-section h2 {
      font-size: 2rem;
      color: #333;
    }
    .placeholder-section p {
      font-size: 1.1rem;
      color: #666;
      max-width: 600px;
      margin-top: 20px;
    }
    /* --- End of ADDED Styles --- */

    .carousel {
      position: relative;
      z-index: 1;
      height: 100vh;
      overflow: hidden;
      pointer-events: none;
    }

    /* --- Carousel Item Base --- */
    .carousel-item {
      --items: 6; /* Make sure this matches your total item count */
      --width: clamp(150px, 30vw, 300px);
      --height: clamp(200px, 40vw, 400px);
      --x: calc(var(--active) * 800%);
      --y: calc(var(--active) * 200%);
      --rot: calc(var(--active) * 120deg);
      --opacity: calc(var(--zIndex) / var(--items) * 3 - 2);
      
      overflow: hidden;
      position: absolute;
      z-index: var(--zIndex);
      width: var(--width);
      height: var(--height);
      margin: calc(var(--height) * -0.5) 0 0 calc(var(--width) * -0.5);
      border-radius: 10px;
      top: 50%;
      left: 50%;
      user-select: none;
      transform-origin: 0% 100%;
      box-shadow: 0 10px 50px 10px rgba(0, 0, 0, .5);
      background: black;
      pointer-events: all;
      transform: translate(var(--x), var(--y)) rotate(var(--rot));
      
      /* --- IMPROVED transition for smoother back/forth animation --- */
      transition: transform .6s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .carousel-item .carousel-box {
      position: absolute;
      z-index: 1;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: opacity .6s cubic-bezier(0.2, 0.8, 0.2, 1);
      opacity: var(--opacity);
      /* Removed font-family here, let content inherit */
    }

    .carousel-item .carousel-box:before {
      content: '';
      position: absolute;
      z-index: 1;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* Dark gradient to make text readable */
      background: linear-gradient(to bottom, rgba(0, 0, 0, .6), rgba(0, 0, 0, 0) 40%, rgba(0, 0, 0, .8) 100%);
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
    }

    /* --- NEW Styles for Card Content --- */
    .carousel-item .carousel-content {
      position: absolute;
      z-index: 2;
      bottom: 0;
      left: 0;
      padding: 20px;
      color: #fff;
      width: 100%;
    }

    .carousel-item .title {
      font-size: clamp(18px, 3vw, 26px);
      text-shadow: 0 2px 4px rgba(0, 0, 0, .3);
      font-weight: bold;
      margin-bottom: 5px;
    }

    .carousel-item .desc {
      font-size: clamp(12px, 2vw, 14px);
      line-height: 1.4;
      opacity: 0.85;
      margin-bottom: 15px;
    }

    .carousel-item .btn {
      display: inline-block;
      background: #fff;
      color: #000;
      text-decoration: none;
      font-size: 13px;
      font-weight: bold;
      padding: 6px 14px;
      border-radius: 5px;
      transition: background .3s ease, transform .3s ease;
      cursor: pointer;
    }

    .carousel-item .btn:hover {
      background: #eee;
      transform: scale(1.05);
    }

    /* --- Layout, Logo, Social --- */
    .layout {
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .layout:before {
      content: '';
      position: absolute;
      z-index: 1;
      top: 0;
      left: 90px;
      width: 10px;
      height: 100%;
      border: 1px solid #fff;
      border-top: none;
      border-bottom: none;
      opacity: .15;
    }

    .layout .box {
      position: absolute;
      bottom: 0;
      left: 30px;
      color: #fff;
      transform-origin: 0% 10%;
      transform: rotate(-90deg);
      font-size: 9px;
      line-height: 1.4;
      text-transform: uppercase;
      opacity: .4;
    }

    .logo {
      position: absolute;
      z-index: 2;
      top: 28px;
      right: 28px;
      width: 30px;
      height: 30px;
      background: #fff;
      border-radius: 50%;
      opacity: .5;
      display: flex;
      justify-content: center;
      align-items: center;
      /* font-family: 'Orelo-sw-db', serif; */ /* Use default or Roboto */
      pointer-events: all;
      color: black;
      text-decoration: none;
      font-size: 20px;
      overflow: hidden;
      padding-bottom: .1em;
      font-weight: bold;
    }

    .social {
      position: absolute;
      z-index: 10;
      bottom: 20px;
      right: 25px;
      color: #fff;
      opacity: .4;
    }

    .social a {
      display: inline-block;
      margin-left: 3px;
    }

    .social svg {
      --fill: #fff;
      width: 35px;
      height: 35px;
    }
    
    /* --- NEW: Carousel Navigation Buttons --- */
    .carousel-nav {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      gap: 20px;
    }
    
    .carousel-nav button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .carousel-nav button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .carousel-nav button:active {
      transform: scale(0.95);
    }
    
    .carousel-nav button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .carousel-nav button svg {
      width: 24px;
      height: 24px;
      stroke: #fff;
      stroke-width: 2;
      fill: none;
    }
    /* --- End of NEW Styles --- */

    /* --- Cursors --- */
    .cursor {
      position: fixed;
      z-index: 1000; /* Ensure cursor is on top */
      top: 0;
      left: 0;
      --size: 40px;
      width: var(--size);
      height: var(--size);
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, .2);
      margin: calc(var(--size) * -0.5) 0 0 calc(var(--size) * -0.5);
      transition: transform .85s cubic-bezier(0, 0.02, 0, 1);
      display: none;
      pointer-events: none;
    }

    .cursor2 {
      --size: 2px;
      transition-duration: .7s;
    }

    @media (pointer: fine) {
      .cursor {
        display: block;
      }
    }

    /*
    ==================================================
    MOBILE-FRIENDLY STYLES
    ==================================================
    */
    @media (max-width: 768px) {
      /* Hide custom cursors on touch devices */
      .cursor,
      .cursor2 {
        display: none !important;
      }
      
      /* Make cards bigger and stack them more */
      .carousel-item {
        --width: clamp(280px, 80vw, 320px);
        --height: clamp(350px, 100vw, 400px);

        /* --- Adjust animation for mobile --- */
        /* Less horizontal spread */
        --x: calc(var(--active) * 100%); 
        /* More vertical spread (stacking) */
        --y: calc(var(--active) * 120%); 
        /* Much less rotation */
        --rot: calc(var(--active) * 20deg); 
      }
      
      /* Adjust text sizes for mobile */
      .carousel-item .title {
        font-size: 22px;
      }
      .carousel-item .desc {
        font-size: 14px;
        margin-bottom: 12px;
      }
      .carousel-item .btn {
        font-size: 14px;
        padding: 8px 16px;
      }
      
      /* Reposition layout elements */
      .layout:before {
        left: 20px;
      }
      .layout .box {
        left: -20px;
        bottom: 50px;
      }
      .social {
        right: 15px;
        bottom: 15px;
      }
      .logo {
        top: 20px;
        right: 20px;
      }

      /* --- NEW: Mobile Nav Buttons --- */
      .carousel-nav {
        bottom: 20px; /* A bit higher on mobile */
      }
      .carousel-nav button {
        width: 50px;
        height: 50px;
      }
      .carousel-nav button svg {
        width: 20px;
        height: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- ======================= -->
  <!-- ADDED Top Random Section  -->
  <!-- ======================= -->
  <section class="placeholder-section" style="border-bottom: none; background-color: #e9e9e9;">
    <div>
      <h2>This is the Top Section</h2>
      <p>Here you can have a hero banner, navigation, or any other content. Scroll down to see the interactive slider.</p>
    </div>
  </section>

  <!-- ==================================== -->
  <!-- NEW Sticky Scroll Container Wrapper -->
  <!-- ==================================== -->
  <div class="sticky-scroll-container">
    <section class="slider-section">
      <div class="carousel">
        
        <!-- ITEM 1: Beginner Lesson -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/949299844/it/foto/vista-prospettica-dellesterno-delledificio-contemporaneo.jpg?s=612x612&w=0&k=20&c=_DR1aRHuTEV3EYBJo1ZXq1pF4SgwB9EVWQLaBj4sC5g=" alt="Modern building exterior"/>
            <div class="carousel-content">
              <div class="title">Beginner Surf Lesson</div>
              <div class="desc">Learn the basics of surfing, from paddling to popping up, in a safe and fun environment.</div>
              <a href="#beginner" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
        <!-- ITEM 2: Intermediate Lesson -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/1150545984/it/foto/palazzo-moderno-di-lusso-con-piscina.jpg?s=612x612&w=0&k=20&c=Pbrai_VGc9tUviMCF1UaBErdS1YGyIVWsD29jzMZwTY=" alt="Luxury building with pool"/>
            <div class="carousel-content">
              <div class="title">Intermediate Lesson</div>
              <div class="desc">Take your skills to the next level. We'll focus on catching green waves and basic maneuvers.</div>
              <a href="#intermediate" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
        <!-- ITEM 3: Advanced Lesson -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/1214351345/it/foto/guardando-direttamente-lo-skyline-del-quartiere-finanziario-nel-centro-di-londra-immagine-di.jpg?s=612x612&w=0&k=20&c=oNNbPzPvcQ-4RA6AeatNIxHQIafBiXmDRtUUY0Ska-I=" alt="London financial district"/>
            <div class="carousel-content">
              <div class="title">Advanced Coaching</div>
              <div class="desc">Perfect your technique, learn advanced turns, and get video analysis from our pro coaches.</div>
              <a href="#advanced" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
        <!-- ITEM 4: Private Session -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/904390980/it/foto/foto-di-architettura-contemporanea-astratta.jpg?s=612x612&w=0&k=20&c=_P4Wmx5nq5MeDuimpNklKCBlrLovmCyd9lfiMKeJZDs=" alt="Abstract modern architecture"/>
            <div class="carousel-content">
              <div class="title">Private Session</div>
              <div class="desc">Get one-on-one instruction tailored specifically to your goals and skill level.</div>
              <a href="#private" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
        <!-- ITEM 5: Group Booking -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/130408311/it/foto/piscina-allesterno-della-casa-moderna-al-crepuscolo.jpg?s=612x612&w=0&k=20&c=ZoVjx7uDjoHKmpM1ayW6UR1SQOoYh_xx-QMG_qeOYs0=" alt="Modern house with pool at dusk"/>
            <div class="carousel-content">
              <div class="title">Group Booking</div>
              <div class="desc">Perfect for corporate events, parties, or a fun day out with friends. All levels welcome.</div>
              <a href="#group" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
        <!-- ITEM 6: Surf Camp -->
        <div class="carousel-item">
          <div class="carousel-box">
            <img src="https://media.istockphoto.com/id/1299954175/it/foto/villa-cubica-moderna.jpg?s=612x612&w=0&k=20&c=DhGhb3c1E3DW_fbrWJ_R_Zh0Lbwu6syFeRLsKlZ9no8=" alt="Modern cubic villa"/>
            <div class="carousel-content">
              <div class="title">Weekend Surf Camp</div>
              <div class="desc">An immersive weekend experience with multiple lessons, lodging, and good vibes.</div>
              <a href="#camp" class="btn">Learn More</a>
            </div>
          </div>
        </div>
    
      </div> <!-- .carousel -->
      
      <!-- ================================== -->
      <!-- NEW: Carousel Navigation Buttons -->
      <!-- ================================== -->
      <div class="carousel-nav">
        <button id="prev-btn" title="Previous Item">
          <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
        </button>
        <button id="next-btn" title="Next Item">
          <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
        </button>
      </div>
    
    
      <!-- SVG Definitions (unchanged) -->
      <svg style="display: none">
        <symbol id="ico-instagram" viewBox="0 0 35 35">
          <circle opacity=".2" cx="17.5" cy="17.5" r="17" stroke="var(--fill)" fill="none"></circle>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M24.944 20.476c.028-.457.042-1.282.042-2.476s-.014-2.019-.042-2.476c-.056-1.09-.378-1.93-.965-2.517s-1.422-.91-2.503-.965C21.018 12.014 20.194 12 19 12s-2.019.014-2.476.042c-1.081.047-1.92.368-2.517.965s-.918 1.436-.965 2.518C13.014 15.98 13 16.805 13 18c0 1.194.014 2.019.042 2.476.047 1.09.368 1.93.965 2.517s1.436.91 2.518.965c.466.028 1.29.042 2.475.042 1.184 0 2.01-.014 2.476-.042 1.072-.047 1.906-.368 2.503-.965.597-.597.918-1.436.965-2.517ZM19 13.075h-1.427c-.186 0-.438.01-.755.029a11.61 11.61 0 0 0-.797.07c-.215.028-.401.08-.56.154-.26.102-.489.251-.685.447-.196.196-.35.425-.461.685-.056.15-.103.336-.14.56a7.843 7.843 0 0 0-.084.811 7.113 7.113 0 0 0-.014.741c.01.178.01.453 0 .826-.01.373-.01.573 0 .601.01.028.01.228 0 .601s-.01.648 0 .826c.01.177.014.424.014.74 0 .318.028.588.084.812l.14.56c.112.26.265.489.461.685.196.196.425.345.685.447.15.056.336.108.56.154.224.047.49.07.797.07.308 0 .56.01.755.028.196.019.471.019.826 0 .354-.019.554-.019.601 0 .047.019.242.019.587 0s.62-.019.826 0c.205.019.456.01.755-.028.298-.037.569-.06.811-.07.242-.01.424-.06.546-.154.26-.102.494-.251.699-.447a1.vector 1.75 0 0 0 .447-.686c.056-.149.103-.335.14-.559.038-.224.066-.494.084-.811.019-.317.023-.564.014-.741a11.82 11.82 0 0 1 0-.826c.01-.373.01-.573 0-.601-.01-.028-.01-.228 0-.601s.01-.648 0-.826c-.01-.177-.014-.424-.014-.74 0-.318-.028-.588-.084-.812l-.14-.56a1.956 1.956 0 0 0-1.147-1.133 3.979 3.979 0 0 0-.545-.153 3.915 3.915 0 0 0-.811-.07c-.326 0-.578-.01-.755-.028a5.916 5.916 0 0 0-.826 0c-.372.019-.568.019-.587 0Zm3.706 2.225c.14-.14.21-.308.21-.504a.57.57 0 0 0-.21-.503.767.767 0 0 0-.517-.21.718.718 0 0 0-.504.21.622.622 0 0 0-.21.503c.01.196.08.364.21.504s.299.21.504.21c.205 0 .377-.07.517-.21ZM22.063 18c0 .849-.298 1.576-.895 2.182a2.882 2.882 0 0 1-2.168.895 3.075 3.075 0 0 1-2.182-.895c-.606-.588-.904-1.315-.895-2.182.01-.867.308-1.594.895-2.182.588-.587 1.315-.886 2.182-.895.867-.01 1.59.29 2.168.895.578.606.876 1.333.895 2.182Zm-1.077 0a1.95 1.95 0 0 0-.573-1.413A1.897 1.897 0 0 0 19 16c-.56 0-1.03.196-1.413.587A2.001 2.001 0 0 0 17 18c-.01.55.186 1.021.587 1.413.401.391.872.587 1.413.587.54 0 1.012-.196 1.413-.587.4-.392.592-.863.573-1.413Z"
            transform="translate(-1.5 -0.5)"
            fill="var(--fill)"
          ></path>
        </symbol>
      
        <symbol id="ico-linkedin" viewBox="0 0 35 35">
          <circle opacity=".2" cx="17.5" cy="17.5" r="17" stroke="var(--fill)" fill="none"></circle>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.3025 14.0835C15.3025 14.3845 15.1934 14.6403 14.9752 14.851C14.757 15.0617 14.4786 15.167 14.14 15.167C13.8014 15.167 13.5267 15.0617 13.316 14.851C13.1053 14.6403 13 14.3807 13 14.0722C13 13.7637 13.1053 13.5079 13.316 13.3047C13.5267 13.1016 13.8051 13 14.1512 13C14.4974 13 14.772 13.1016 14.9752 13.3047C15.1783 13.5079 15.2874 13.7675 15.3025 14.0835ZM13.0677 23V16.0248H15.2348V23H13.0677ZM16.4763 16.0248C16.5064 16.8676 16.5214 17.6125 16.5214 18.2596V23H18.7111V18.9819C18.7111 18.7111 18.7336 18.5305 18.7788 18.4402C18.9895 17.8984 19.3582 17.625 19.8849 17.625C20.6223 17.625 20.991 18.1317 20.991 19.14V23H23.158V18.8691C23.158 17.8758 22.9285 17.1272 22.4695 16.623C22.0105 16.1189 21.4048 15.8668 20.6524 15.8668C19.6742 15.8668 18.9594 16.243 18.5079 16.9955H18.4628L18.3499 16.0248H16.4763Z"
            transform="translate(0 -1)"
            fill="var(--fill)"
          ></path>
        </symbol>
      </svg>
    
      <div class="cursor"></div>
      <div class="cursor cursor2"></div>
    
    </section>
  </div> <!-- .sticky-scroll-container -->

  <!-- ========================== -->
  <!-- ADDED Bottom Random Section  -->
  <!-- ========================== -->
  <section class="placeholder-section">
    <div>
      <h2>This is the Bottom Section</h2>
      <p>This content appears after the slider. You can add footers, more articles, contact forms, etc., here. The page is now scrollable.</p>
    </div>
  </section>

  <script>
    /*--------------------
    Vars
    --------------------*/
    let progress = 0; // This will be controlled by scroll
    let active = 0;
    let startX = 0; // MODIFIED: Re-added for drag logic
    let isDown = false; // MODIFIED: Re-added for drag logic

    /*--------------------
    Contants
    --------------------*/
    // REMOVED: speedWheel, speedDrag

    /*--------------------
    Get Z
    --------------------*/
    const getZindex = (array, index) => (array.map((_, i) => (index === i) ? array.length : array.length - Math.abs(index - i)));

    /*--------------------
    Items
    --------------------*/
    const $items = document.querySelectorAll('.carousel-item');
    const numItems = $items.length; // NEW: Get total number of items
    const $cursors = document.querySelectorAll('.cursor');
    // NEW: Get the sticky container
    const $container = document.querySelector('.sticky-scroll-container');
    // NEW: Get Navigation Buttons
    const $prevBtn = document.getElementById('prev-btn');
    const $nextBtn = document.getElementById('next-btn');


    const displayItems = (item, index, active) => {
      const zIndex = getZindex([...$items], active)[index];
      item.style.setProperty('--zIndex', zIndex);
      item.style.setProperty('--active', (index - active) / $items.length);
    };

    /*--------------------
    Animate
    --------------------*/
    const animate = () => {
      progress = Math.max(0, Math.min(progress, 100)); // Clamp progress 0-100
      
      // Ensure we have items before calculating active index
      if (numItems > 0) {
        active = Math.floor(progress / 100 * (numItems - 1));
      } else {
        active = 0;
      }
      
      $items.forEach((item, index) => displayItems(item, index, active));
      
      // NEW: Update button disabled state
      if ($prevBtn && $nextBtn) {
        $prevBtn.disabled = active === 0;
        $nextBtn.disabled = active === numItems - 1;
      }
    };
    
      /* Run animate on load */
    animate();

    /*--------------------
    NEW: Scroll To Item Function
    --------------------*/
    const scrollToItem = (index) => {
      if (numItems <= 1) return;
      
      // Ensure index is clamped between 0 and max items
      const targetIndex = Math.max(0, Math.min(index, numItems - 1));

      // Calculates the exact progress % for the target item
      let targetProgress = (targetIndex / (numItems - 1)) * 100;
      
      if ($container) {
        const containerHeight = $container.offsetHeight;
        const viewportHeight = window.innerHeight;
        const totalScrollableDistance = containerHeight - viewportHeight;
        const pauseDistance = viewportHeight * 1; 
        const animationDistance = totalScrollableDistance - pauseDistance;

        // Calculate the scrollY that corresponds to this progress
        const newScrollY = $container.offsetTop + (targetProgress / 100) * animationDistance;

        // Use 'smooth' behavior for button clicks
        window.scrollTo({ top: newScrollY, behavior: 'smooth' });
      }
    }

    /*--------------------
    Click on Items
    --------------------*/
    $items.forEach((item, i) => {
      item.addEventListener('click', () => {
        // MODIFIED: Use the new helper function
        scrollToItem(i);
      });
    });
    
    /*--------------------
    NEW: Button Click Listeners
    --------------------*/
    if ($prevBtn && $nextBtn) {
      $prevBtn.addEventListener('click', () => {
        // `active` is the *current* item, so we go to active - 1
        scrollToItem(active - 1);
      });
      
      $nextBtn.addEventListener('click', () => {
        scrollToItem(active + 1);
      });
    }


    /*--------------------
    Handlers
    --------------------*/
    // REMOVED: handleWheel

    const handleMouseMove = (e) => {
      // This function now *only* handles the custom cursor
      if (e.type === 'mousemove') {
        $cursors.forEach(($cursor) => {
          $cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
        });
      }
      
      // --- NEW: Re-added drag logic ---
      if (!isDown) return;
      
      // Use clientX for both mouse and touch
      const x = e.clientX || (e.touches && e.touches[0].clientX) || 0;
      
      // Prevent default only on touchmove to allow scrolling
      if (e.type === 'touchmove') {
        e.preventDefault(); 
      }
      
      // Multiplier adjusts drag "sensitivity". Negative to reverse direction.
      // Drag left (negative X delta) should scroll down (positive scroll delta)
      const scrollDelta = (x - startX) * -2.5; 
      // We use scrollBy to create the "drag" feel
      window.scrollBy(0, scrollDelta);
      startX = x;
      // --- End of NEW drag logic ---
    };

    // --- NEW: Re-added mouse/touch down/up handlers ---
    const handleMouseDown = e => {
      // Check if the click is on a button
      const targetElement = e.target.closest('button');
      if (targetElement && (targetElement.id === 'prev-btn' || targetElement.id === 'next-btn')) {
        return; // Don't prevent default or start drag on nav buttons
      }
      
      // Prevent default only on touchstart to allow click events on buttons
      if (e.type === 'touchstart') {
         // Check if the click is on a link button
        if (e.target.classList.contains('btn')) {
          return; // Don't prevent default on card buttons
        }
        e.preventDefault(); 
      }
      isDown = true;
      startX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
    };

    const handleMouseUp = () => {
      isDown = false;
    };

    // --- NEW: Scroll Handler ---
    const handleScroll = () => {
      if (!$container) return; // Guard clause

      const containerTop = $container.offsetTop;
      const containerHeight = $container.offsetHeight;
      const viewportHeight = window.innerHeight;

      // Total distance we can scroll *while* the sticky element is active
      const totalScrollableDistance = containerHeight - viewportHeight;
      
      // --- MODIFIED: Logic for "pause" ---
      // Define how long the pause should be (in pixels). 1 * vh = 100vh.
      const pauseDistance = viewportHeight * 1; 
      // The distance over which the animation should play
      const animationDistance = totalScrollableDistance - pauseDistance;
      // --- End of MODIFIED ---

      // How far we've scrolled *since* the sticky container became active
      let scrollAmount = window.scrollY - containerTop;

      // Clamp the scroll amount
      scrollAmount = Math.max(0, Math.min(scrollAmount, totalScrollableDistance));

      if (animationDistance > 0) {
        // --- MODIFIED: Calculate progress based on *animation* distance ---
        let animationProgress = (scrollAmount / animationDistance) * 100;
        progress = Math.max(0, Math.min(animationProgress, 100)); // Clamp progress
      } else {
        // Handle edge case where container isn't taller than viewport
        progress = (window.scrollY > containerTop) ? 100 : 0;
      }
      
      // Calling animate() here updates the cards AND the button states
      animate();
    };


    /*--------------------
    Listeners
    --------------------*/
    
    // KEPT: mousemove for the cursor only
    document.addEventListener('mousemove', handleMouseMove);

    // NEW: Added scroll listener
    document.addEventListener('scroll', handleScroll, { passive: true });
    
    // --- NEW: Re-added all mouse and touch listeners ---
    // Make sure touch listeners are NOT passive, so we can preventDefault
    document.addEventListener('mousedown', handleMouseDown);
    document.addEventListener('mouseup', handleMouseUp);
    document.addEventListener('touchstart', handleMouseDown, { passive: false });
    document.addEventListener('touchmove', handleMouseMove, { passive: false });
    document.addEventListener('touchend', handleMouseUp);
    // --- End of NEW listeners ---

    // Run scroll handler once on load to set initial state
    // in case of page refresh at a non-zero scroll position
    handleScroll();

  </script>

</body>
</html>